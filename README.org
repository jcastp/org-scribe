#+TITLE: emacs-writing - Creative Writing Toolkit for Org-mode
#+AUTHOR: Javier Castilla
#+EMAIL: jcastp@pm.me

* Overview

=emacs-writing= is a comprehensive, batteries-included toolkit for novelists, short story writers, and creative writers working in Emacs Org-mode. It provides everything you need from project creation to final export: templates, writing environments, word counting, progress tracking, and powerful search capabilities.

*Version 0.2.0* merges the functionality of =emacs-writing-template=, providing a complete integrated writing environment in a single package.

* Features

** Complete Workflow (v0.2.0)

*** Project Creation & Templates
- *Create Novel Projects*: Generate complete project structure from templates with a single command
- *Scene Insertion*: Insert pre-formatted scene templates with metadata properties
- *Chapter Insertion*: Add chapter templates with word count tracking
- *Template Customization*: Edit templates to match your workflow
- *Bilingual Support*: English and Spanish templates included
- *Git Integration*: Projects automatically initialized with git

*** Writing Tools
- *Character Linking* (NEW in v0.2.1): ID-based links between scenes and character profiles
  - Automatic ID creation for captured characters
  - Click character names in scene properties to jump to full profiles
  - Menu-based character selection for scene properties
  - Searches work with both plain text and ID links
  - Stable links that survive character name changes
- *Word Counting*: Accurate word counting that excludes Org-mode metadata (comments, properties, drawers)
- *Progress Tracking*: Daily word count tracking with org-tracktable integration
- *Writing Modes*: Four mutually exclusive modes for different workflows:
  - Distraction-free writing mode
  - Focus mode with buffer narrowing
  - Project navigation mode (with treemacs and imenu-list)
  - Three-pane editing layout
- *Search Functions*: Find scenes by POV, character, location, or plot keywords using org-ql (handles ID links)
- *Dictionary Tools*: Spanish RAE dictionary API, synonym lookup, and translation support
- *Capture System*: Project-aware note capture that finds the right notes file
- *Export Filters*: Scene break replacement for different export backends
- *Hydra Menu*: Unified keyboard-driven menu for quick access to all functions

** Bilingual Support

Full support for English/Spanish bilingual writing:
- Spanish RAE dictionary integration
- WordReference synonym lookup
- Automatic language detection
- Bilingual project structure support (notes/notas directories)

* Installation

** Dependencies

*** Required Packages

- Emacs 29.1+
- org-mode 9.6+
- [[https://github.com/alphapapa/org-ql][org-ql]] (0.8+)
- [[https://github.com/joostkremers/writeroom-mode][writeroom-mode]] (3.7+)
- [[https://codeberg.org/jcastp/org-context-extended][org-context-extended]]
- [[https://codeberg.org/jcastp/org-tracktable][org-tracktable]]

*** Optional Packages

- [[https://github.com/minad/consult][consult]] - For theme switching in writing modes
- [[https://github.com/protesilaos/fontaine][fontaine]] - For font preset management
- [[https://github.com/Alexander-Miller/treemacs][treemacs]] - For project navigation mode
- [[https://github.com/bmag/imenu-list][imenu-list]] - For document outline in editing modes
- [[https://github.com/guess-language/guess-language.el][guess-language]] - For automatic language detection
- [[https://github.com/lorniu/gt.el][gt]] - For translation support
- [[https://github.com/SavchenkoValeriy/emacs-powerthesaurus][powerthesaurus]] - For English thesaurus
- [[https://github.com/nobiot/org-remark][org-remark]] - For text annotations

** From Source

Clone the repository:

#+begin_src sh
git clone https://codeberg.org/jcastp/emacs-writing ~/.emacs.d/emacs-writing
#+end_src

Add to your Emacs configuration:

#+begin_src emacs-lisp
(add-to-list 'load-path "~/.emacs.d/emacs-writing")
(require 'emacs-writing)

;; Optional: Enable automatically in org-mode
(add-hook 'org-mode-hook #'emacs-writing-mode)

;; Optional: Set up recommended keybindings
(emacs-writing-setup)
#+end_src

** Using use-package (Recommended)

#+begin_src emacs-lisp
(use-package emacs-writing
  :vc (:url "https://codeberg.org/jcastp/emacs-writing"
       :branch "main"
       :rev :newest)
  :after org
  :hook (org-mode . emacs-writing-mode)
  :config
  ;; Customize settings
  (setq my-writing-env-work-theme 'poet)
  (setq my-writing-env-normal-theme 'ef-deuteranopia-dark)
  (setq writing-stories-directory "~/writing/exercises")

  ;; Keybindings
  (global-set-key (kbd "<f8> <f8>") 'hydra-writing/body))
#+end_src

* Quick Start

** Create Your First Novel Project

1. Install the package and dependencies
2. Run =M-x writing-create-project= (or =F8 F8 P= if using hydra)
3. Choose a directory and enter your novel title
4. Start writing in the generated =novel.org= file!

** Working in an Existing Project

1. Open an org-mode file in your project
2. Press =<f8> <f8>= to open the hydra menu
3. Try a writing mode: press =w= for distraction-free mode
4. Use =n= to count words in the current section
5. Insert scenes with =S= or chapters with =C=

* Usage

** Project Creation

*** Create a New Novel Project

=M-x writing-create-project= or press =F8 F8 P= in hydra

This creates a complete project structure:

#+begin_example
MyNovel/
├── README.org              # Project overview and status
├── novel.org              # Main manuscript with progress tracking
├── revision.org           # Revision tracking
├── writing-journal.org    # Reflective writing journal
├── plan/                  # Planning documents
│   ├── characters.org
│   ├── locations.org
│   ├── plot.org
│   ├── timeline.org
│   └── objects.org
└── notes/                 # Research and notes
    ├── notes.org
    └── research.org
#+end_example

The project includes:
- Pre-configured word count tracking
- Scene and chapter templates
- Progress tracking tables
- Export configurations for LaTeX, ODT, HTML, EPUB
- Git repository initialization

*** Insert Scene or Chapter

While working in your manuscript:

- =M-x writing-insert-scene= or =F8 F8 S=: Insert a scene with metadata properties (PoV, Characters, Plot, Location, etc.)
- =M-x writing-insert-chapter= or =F8 F8 C=: Insert a chapter heading with word count property

*** Quick Project File Access

=M-x writing-open-project-file= or =F8 F8 O=

Opens project files with completion (novel.org, plan/characters.org, notes/notes.org, etc.)

*** Customize Templates

=M-x writing-edit-templates=

Opens the template directory for editing. Customize templates to match your workflow!

** Writing Modes

*** Distraction-Free Mode (=my-writing-env-mode=)

Press =F8 F8 w= or use the hydra menu.

Changes:
- Switches to writing theme
- Changes font to writing preset
- Activates writeroom-mode
- Shows line numbers

*** Focus Mode (=my-writing-env-mode-focus=)

Press =F8 F8 f= or use the hydra menu.

Like distraction-free mode, but also narrows to the current org section.

*** Project Navigation Mode (=project-writing-mode=)

Opens treemacs (file tree) and imenu-list (document outline) for easy navigation.

*** Editing Mode (=writing/editing-mode=)

Three-pane layout:
- Left: Document outline (imenu-list)
- Center: Main document
- Right: Notes file (org-remark annotations)

** Word Counting

*** Count Words in Selection

=M-x org-context-count-words= or press =F8 F8 n= in hydra

*** Add Word Count Properties

=M-x writing/ews-org-count-words= or press =F8 F8 m= in hydra

Adds a =WORDCOUNT= property to each heading.

*** Generate Word Count Table with Progress

Add this to your org file:

#+begin_example
#+BEGIN: org-generate-wordcount-table
#+END:
#+end_example

Update with =C-c C-c= on the #+BEGIN line.

This generates a comprehensive table showing:
- Hierarchical heading structure (Acts, Chapters, Scenes)
- Wordcount (from =WORDCOUNT= property)
- Objective (from =WORD-OBJECTIVE= property, when set)
- Progress (auto-calculated percentage)

**Example output:**

#+begin_example
| Heading                     | Wordcount | Objective | Progress |
|-----------------------------+-----------+-----------+----------|
| - Act I                     |       711 |      5000 |      14% |
| -- Chapter 1                |       447 |      1500 |      30% |
| --- Scene 1 - The Alarm     |       167 |       500 |      33% |
| --- Scene 2 - Coffee Shop   |       280 |       500 |      56% |
#+end_example

*** Set Word Objectives for Progress Tracking

Add the =WORD-OBJECTIVE= property to your Acts, Chapters, or Scenes to enable automatic progress calculation:

#+begin_example
* Act I :ignore:
:PROPERTIES:
:WORDCOUNT: 711
:WORD-OBJECTIVE: 5000
:END:
#+end_example

When you update the word count table (with =C-c C-c= on the #+BEGIN line), progress percentages will be automatically calculated for any section that has a =WORD-OBJECTIVE= property.

** Character Linking

*** Overview

Link character names in scene properties directly to their full profiles in =plan/characters.org=. Click on character names to jump to detailed character information!

*** Quick Start

For existing projects:
1. =M-x writing/setup-character-links= or press =F8 F8 L s=
2. Adds unique IDs to all characters
3. Optionally converts existing scenes to use links

For new characters:
- Characters created with =writing/capture-character= (F8 F8 h) automatically get IDs
- No manual setup needed!

*** Setting Scene Characters

*Set PoV Character* (=F8 F8 L p=):
1. Position on scene heading
2. Press =F8 F8 L p=
3. Select character from menu
4. PoV property updated with ID link

*Set Scene Characters* (=F8 F8 L c=):
1. Position on scene heading
2. Press =F8 F8 L c=
3. Select characters one by one
4. Press RET to finish
5. Characters property updated with ID links

*** Navigation

*Jump to PoV Character* (=F8 F8 L j=):
- Instantly jump from scene to PoV character's full profile
- Press =C-c &= to return to scene

*Click Any Character Link*:
- Position cursor on character name in properties
- Press =C-c C-o= (or click with mouse)
- Jumps to character profile

*** How It Works

Scene properties change from plain text to ID links:

Before:
#+begin_example
:PoV: Alex
:Characters: Alex, Sam
#+end_example

After:
#+begin_example
:PoV: [[id:char-alex-rivera-001][Alex]]
:Characters: [[id:char-alex-rivera-001][Alex]], [[id:char-sam-chen-002][Sam]]
#+end_example

Benefits:
- Click to navigate to character profiles
- Links survive character renames
- Searches still work (automatic extraction)
- Quick reference while writing

*** Character Linking Hydra Menu

Press =F8 F8 L= to access:
- =p= - Set PoV character
- =c= - Set scene characters
- =j= - Jump to PoV character
- =l= - Link current scene
- =L= - Link all scenes
- =i= - Add IDs to characters
- =s= - Setup linking system

See [[file:CHARACTER-LINKING.org][Character Linking Guide]] for complete documentation.

** Search Functions

All search functions are available via the hydra menu (=F8 F8=):

- =u=: Find scenes by POV character
- =i=: Find scenes with character
- =o=: Find scenes by plot keyword
- =y=: Find scenes by location
- =a=: Find all TODO items in project

These searches use org properties and work with both plain text and ID links:

#+begin_example
* Chapter 1
:PROPERTIES:
:PoV: [[id:char-alice-001][Alice]]
:Characters: [[id:char-alice-001][Alice]], [[id:char-bob-002][Bob]]
:Location: Coffee Shop
:Plot: First meeting
:END:
#+end_example

Searching for "Alice" finds this scene even with ID links!

** Dictionary Tools

*** Spanish RAE Dictionary

=M-x writing/rae-api-lookup= or press =F8 F8 r= in hydra

Looks up Spanish words in the Real Academia Española dictionary.

*** Synonyms

=M-x writing/sinonimo= or press =F8 F8 s= in hydra

Opens WordReference Spanish synonyms in a side window.

** Capture Notes

=M-x writing/capture-to-file= or press =C-c W=

Automatically finds the right notes file in your project structure.

** Export with Scene Breaks

Add this macro to your org file:

#+begin_example
#+MACRO: scene-break SCENE-BREAK
#+end_example

Use ={{{scene-break}}}= where you want scene breaks.

When exporting, scene breaks will be replaced with appropriate separators for each backend (HTML, LaTeX, Markdown, etc.).

* Project Structure

=emacs-writing= creates and works with structured novel projects:

#+begin_example
project-root/
├── .writing-project       # Project marker file
├── README.org            # Project overview
├── novel.org             # Main manuscript with progress tracking (or novela.org for Spanish)
├── revision.org          # Revision tracking
├── writing-journal.org   # Reflective writing journal (or diario-escritura.org for Spanish)
├── plan/                 # Planning documents
│   ├── characters.org    # Character profiles
│   ├── locations.org     # World building
│   ├── plot.org         # Story structure
│   ├── timeline.org     # Chronology
│   └── objects.org      # Important items
└── notes/               # Notes and research
    ├── notes.org        # General notes
    └── research.org     # Research tracking
#+end_example

Projects can be created with =M-x writing-create-project= or the package works with any org-mode file structure.

* Configuration

See =M-x customize-group RET writing RET= for all customization options.

Key variables:

** Project & Templates
- =writing-template-directory= - Location of project templates (default: novel-en)
- =writing-template-language= - Default language for templates ('en or 'es)
- =writing-stories-directory= - Where writing exercise files are created

** Writing Modes
- =my-writing-env-work-theme= - Theme for writing modes
- =my-writing-env-normal-theme= - Normal theme
- =my-writing-env-work-font= - Font preset for writing
- =my-writing-env-work-width= - Writeroom width

** Export
- =writing/scene-break-replacements= - Scene break strings for export backends

* Keybindings

Default keybindings when =emacs-writing-mode= is active:

- =F8 F8= - Open hydra menu
- =C-c W= - Capture note

** Hydra Menu (F8 F8)

The hydra menu provides quick access to all functions:

*** Project
- =P= - Create new project
- =C= - Insert chapter
- =S= - Insert scene
- =O= - Open project file

*** Modes
- =p= - Project navigation mode
- =w= - Writing mode (distraction-free)
- =f= - Focus mode
- =e= - Editing mode

*** Writing Tools
- =r= - RAE dictionary
- =s= - Synonyms
- =d= - Thesaurus
- =c= - Capture note

*** Count Words
- =n= - Count words
- =m= - Add word count properties
- =t= - Update tracking table

*** Searches
- =u= - Find scenes by POV
- =i= - Find scenes with character
- =o= - Find scenes by plot
- =y= - Find scenes by location
- =a= - Find TODOs in project

*** Character Linking
- =L= - Open character linking submenu

From the character linking submenu (=F8 F8 L=):
- =p= - Set PoV character
- =c= - Set scene characters
- =j= - Jump to PoV character
- =l= - Link current scene
- =L= - Link all scenes
- =i= - Add IDs to characters
- =s= - Setup linking system

* Contributing

Contributions are welcome! Please:

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Submit a pull request

* License

GPL-3.0-or-later

* Links

- Repository: https://codeberg.org/jcastp/emacs-writing
- Issues: https://codeberg.org/jcastp/emacs-writing/issues
- Dependencies: [[https://codeberg.org/jcastp/org-context-extended][org-context-extended]] (smart word counting)
- Dependencies: [[https://codeberg.org/jcastp/org-tracktable][org-tracktable]] (progress tracking)

** Version 0.2.1 Changes (NEW)

Version 0.2.1 introduces the *Character Linking System*:

- *ID-Based Character Links*: Link scene properties to character profiles
- *Automatic ID Creation*: New characters automatically get unique IDs
- *Menu-Based Selection*: Select characters from completion menus
- *Click Navigation*: Click character names to jump to full profiles
- *Smart Searches*: Search functions work with both plain text and ID links
- *Batch Operations*: Convert entire projects at once
- *Backward Compatible*: Works with existing plain text properties

See [[file:CHARACTER-LINKING.org][Character Linking Guide]] for complete documentation and [[file:examples/demo-novel/CHARACTER-LINKING-DEMO.org][Interactive Demo]].

** Version 0.2.0 Changes

Version 0.2.0 merges [[https://codeberg.org/jcastp/emacs-writing-template][emacs-writing-template]] into this package, providing:

- Project creation with customizable templates
- Scene and chapter insertion functions
- Quick project file navigation
- Integrated git initialization
- Bilingual template support (English/Spanish)

All =writing-project-*= functions from the old package are available as backward-compatible aliases.

*** Migration from emacs-writing-template

If you were using =emacs-writing-template= separately:

1. Remove =emacs-writing-template= from your config
2. Update to =emacs-writing= 0.2.0+
3. Old function names still work (with deprecation warnings):
   - =writing-project-create-novel-project= → =writing-create-project=
   - =writing-project-insert-scene= → =writing-insert-scene=
   - =writing-project-insert-chapter= → =writing-insert-chapter=
   - =writing-project-open-novel-file= → =writing-open-project-file=

* Acknowledgments

This package was developed for bilingual (English/Spanish) creative writing workflows. It integrates many excellent Emacs packages to provide a comprehensive writing environment.
